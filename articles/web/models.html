<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Models â€¢ ncvreg</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<script src="../../extra.js"></script><meta property="og:title" content="Models">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">ncvreg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.11.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/getting-started.html">Getting started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Learn more
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/web/models.html">Models</a>
    </li>
    <li>
      <a href="../../articles/web/penalties.html">Penalties</a>
    </li>
    <li>
      <a href="../../articles/web/inference-mfdr.html">Inference: Marginal false discovery rates</a>
    </li>
    <li>
      <a href="../../articles/web/inference-local.html">Inference: Local mfdr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pbreheny/ncvreg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Models</h1>
                        <h4 class="author">Patrick Breheny</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pbreheny/ncvreg/blob/master/vignettes/web/models.rmd"><code>vignettes/web/models.rmd</code></a></small>
      <div class="hidden name"><code>models.rmd</code></div>

    </div>

    
    
<p><code>ncvreg</code> fits models that fall into the penalized likelihood framework. Rather than estimating <span class="math inline">\(\bb\)</span> by maximizing the likelihood, in this framework we estimate <span class="math inline">\(\bb\)</span> by minimizing the objective function <span class="math display">\[
Q(\bb|\X, \y) = \frac{1}{n}L(\bb|\X,\y) + P_\lam(\bb),
\]</span> where the loss function <span class="math inline">\(L(\bb|\X,\y)\)</span> is the deviance (<span class="math inline">\(-2\)</span> times the log-likelihood), <span class="math inline">\(P_\lam(\bb)\)</span> is the penalty, and <span class="math inline">\(\lam\)</span> is a regularization parameter that controls the tradeoff between the two components. This article describes the different loss models available in <code>ncvreg</code>; see <a href="penalties.html">penalties</a> for more information on the different penalties available.</p>
<div id="gaussian-linear-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#gaussian-linear-regression" class="anchor"></a>Gaussian (linear regression)</h1>
<p>In linear regression, the loss function is simply the squared error loss: <span class="math display">\[
L(\bb|\X,\y) = \norm{\y-\X\bb}_2^2;
\]</span> this loss is proportional to the deviance if the outcome <span class="math inline">\(\y\)</span> follows a normal distribution with constant variance and mean given by <span class="math inline">\(\X\bb\)</span>.</p>
<p>In the <code>Prostate</code> data packaged with <code>ncvreg</code>, the response is the prostate specific antigen (PSA), measured on the log scale, and follows an approximate normal distribution; see <code><a href="../../reference/Prostate.html">?Prostate</a></code> for more information on the data set. Loading this data set into R,</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(Prostate)</a>
<a class="sourceLine" id="cb1-2" title="2">X &lt;-<span class="st"> </span>Prostate<span class="op">$</span>X</a>
<a class="sourceLine" id="cb1-3" title="3">y &lt;-<span class="st"> </span>Prostate<span class="op">$</span>y</a></code></pre></div>
<p>By default, <code>ncvreg</code> fits a linear regression model with a minimax concave penalty (MCP):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/ncvreg.html">ncvreg</a></span>(X, y)</a></code></pre></div>
<p>This produces a path of coefficient estimates, which we can plot with</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(fit)</a></code></pre></div>
<p><img src="models_files/figure-html/fit-linear-1.png" width="480"></p>
<p>Although the least squares loss function is convex, the MCP penalty is not. The resulting objective function, therefore, may or may not be convex. <code>ncvreg</code> uses a local convexity diagnostic, as described in <a href="http://myweb.uiowa.edu/pbreheny/pdf/Breheny2011.pdf">Breheny and Huang (2011)</a>, to identify the regions of the coefficient path where the objective function is not convex; this is the gray shaded region in the plot. Users should be aware that solutions in this region may only be local optima of the objective function, not global ones.</p>
<p>Post-selection inference is available using the <code>summary</code> method:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(fit, <span class="dt">lambda=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co"># MCP-penalized linear regression with n=97, p=8</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co"># At lambda=0.0500:</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co"># -------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#   Nonzero coefficients         :   6</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#   Expected nonzero coefficients:   2.54</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#   Average mfdr (6 features)    :   0.424</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co"># </span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#         Estimate      z     mfdr Selected</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co"># lcavol   0.53179  8.880  &lt; 1e-04        *</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co"># svi      0.67256  3.945 0.010189        *</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co"># lweight  0.60390  3.666 0.027894        *</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co"># lbph     0.08875  1.928 0.773014        *</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co"># age     -0.01531 -1.788 0.815269        *</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co"># pgg45    0.00168  1.160 0.917570        *</span></a></code></pre></div>
<p>The local marginal false discovery rate (mfdr) is given for each of the selected features. Roughly, this corresponds to the probability that the given feature is marginally independent of the residuals at that value of <span class="math inline">\(\lam\)</span>. In this case, it would appear that <code>lcavol</code>, <code>svi</code>, and <code>lweight</code> are clearly associated with the response, even after adjusting for the other variables in the model, while <code>lbph</code>, <code>age</code>, and <code>pgg45</code> may be false positives selected simply by chance. For more information on <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> and its various options, see <a href="inference-local.html">here</a>.</p>
<p>Typically, one would carry out cross-validation for the purposes of assessing the predictive accuracy of the model at various values of <span class="math inline">\(\lambda\)</span>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">cvfit &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/cv-ncvreg.html">cv.ncvreg</a></span>(X, y)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cvfit)</a></code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<p>By default, the cross-validation error (CVE) is plotted; for all models in <code>ncvreg</code>, the cross-validation error is defined as <span class="math display">\[
\begin{align*}
\CVE(\lam) &amp;= \frac{1}{n} \sum_i L\{y_i, \eta_{-i}(\lam)\}\\
\eta_{-i}(\lam) &amp;= \sum_j x_{ij}\bh_j(-i,\lam),
\end{align*}
\]</span> where <span class="math inline">\(\bbh(-i,\lam)\)</span> denotes the estimated regression coefficients at <span class="math inline">\(\lam\)</span> for the fold in which observation <span class="math inline">\(i\)</span> has been left out. The loss function is determined by the type of model; for least squares loss, therefore, <span class="math display">\[
\CVE(\lam) = \frac{1}{n} \sum_i\{y_i-\eta_{-i}(\lam)\}^2\\
\]</span></p>
<p>Alternatively, one can plot <span class="math inline">\(\hat{\sigma}(\lam)\)</span>, the signal-to-noise ration (SNR), or <span class="math inline">\(R^2\)</span>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cvfit, <span class="dt">type=</span><span class="st">'cve'</span>)</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cvfit, <span class="dt">type=</span><span class="st">'scale'</span>)  <span class="co"># sigma hat</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cvfit, <span class="dt">type=</span><span class="st">'snr'</span>)</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cvfit, <span class="dt">type=</span><span class="st">'rsq'</span>)</a></code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>Calling <code>summary</code> on a <code>cv.ncvreg</code> object will provide a summary of these quantities at the value which minimizes <span class="math inline">\(\CVE\)</span>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(cvfit)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co"># MCP-penalized linear regression with n=97, p=8</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co"># At minimum cross-validation error (lambda=0.0104):</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co"># -------------------------------------------------</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#   Nonzero coefficients: 8</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#   Cross-validation error (deviance): 0.59</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#   R-squared: 0.55</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#   Signal-to-noise ratio: 1.22</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#   Scale estimate (sigma): 0.771</span></a></code></pre></div>
<p>To access the elements of the fit, <code>coef</code> and <code>predict</code> methods are provided. For example, <code><a href="https://rdrr.io/r/stats/coef.html">coef(fit, lambda=0.02)</a></code> returns the estimated coefficients at <span class="math inline">\(\lambda\)</span>=0.02, while <code><a href="https://rdrr.io/r/stats/coef.html">coef(cvfit)</a></code> returns the estimated coefficients at the value of <span class="math inline">\(\lam\)</span> minimizing CVE.</p>
</div>
<div id="binomial-logistic-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#binomial-logistic-regression" class="anchor"></a>Binomial (logistic regression)</h1>
<p>In logistic regression, the loss function is: <span class="math display">\[
L(\bb|\X,\y) = -2\sum_{i:y_i=1}\log\ph_i - 2\sum_{i:y_i=0}\log(1-\ph_i);
\]</span> this loss is the deviance for a binomial distribution with probabilities <span class="math inline">\(P(Y_i=1)=\ph_i\)</span> given by: <span class="math display">\[
\ph_i = \frac{\exp(\eta_i)}{1+\eta_i},
\]</span> where <span class="math inline">\(\be = \X\bb\)</span> denotes the linear predictors. The <code>Heart</code> data provides an example of data that can be used with logistic regression. Loading this data set into R,</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(Heart)</a>
<a class="sourceLine" id="cb8-2" title="2">X &lt;-<span class="st"> </span>Heart<span class="op">$</span>X</a>
<a class="sourceLine" id="cb8-3" title="3">y &lt;-<span class="st"> </span>Heart<span class="op">$</span>y</a></code></pre></div>
<p>One can change the loss function by specifying <code>family</code>; to fit a penalized logistic regression model,</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/ncvreg.html">ncvreg</a></span>(X, y, <span class="dt">family=</span><span class="st">'binomial'</span>)</a></code></pre></div>
<p>As before, you can call <code>plot</code>, <code>coef</code>, <code>predict</code>, <code>summary</code>, etc. on <code>fit</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(fit, <span class="dt">lambda=</span><span class="fl">0.02</span>)</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co"># MCP-penalized logistic regression with n=462, p=9</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co"># At lambda=0.0200:</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co"># -------------------------------------------------</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">#   Nonzero coefficients         :   7</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co">#   Expected nonzero coefficients:   1.90</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co">#   Average mfdr (7 features)    :   0.271</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co"># </span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co">#           Estimate       z      mfdr Selected</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co"># age      0.0506911  5.8368   &lt; 1e-04        *</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="co"># famhist  0.9096673  4.1177 0.0024258        *</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co"># tobacco  0.0802204  3.3117 0.0443510        *</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="co"># typea    0.0370468  3.1833 0.0656364        *</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="co"># ldl      0.1657752  3.1019 0.0831088        *</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co"># obesity -0.0087180 -1.2579 0.8340700        *</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co"># sbp      0.0001648  0.9981 0.8707837        *</span></a></code></pre></div>
<p>Cross-validation is similar, although (a) there is a new option, <code>type='pred'</code> for cross-validated prediction error (misclassification error) and (b) <code>type='scale'</code> is no longer an option:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">cvfit &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/cv-ncvreg.html">cv.ncvreg</a></span>(X, y, <span class="dt">family=</span><span class="st">'binomial'</span>)</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cvfit, <span class="dt">type=</span><span class="st">'all'</span>)</a></code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-10-1.png" width="480"></p>
<p>Note that, as defined above, cross-validation error is the cross-validated deviance. At its optmium, the penalized logistic regression model can predict about 73% of coronary heart disease cases correctly (27% misclassification).</p>
</div>
<div id="poisson" class="section level1">
<h1 class="hasAnchor">
<a href="#poisson" class="anchor"></a>Poisson</h1>
<p>In Poisson regression, the loss function is: <span class="math display">\[
L(\bb|\X,\y) = 2\sum_i \left\{y_i\log y_i - y_i\log \mu_i + mu_i - y_i\right\};
\]</span> note that some of these terms are constant with respect to <span class="math inline">\(\mu_i\)</span> and can therefore be ignored during optimization. This loss is the deviance for a Poisson distribution <span class="math inline">\(Y_i \sim \text{Pois}(\mh_i)\)</span> with rate parameter given by: <span class="math display">\[
\mh_i = \exp(\eta_i).
\]</span> To fit a penalized Poisson regression model with <code>ncvreg</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/ncvreg.html">ncvreg</a></span>(X, y, <span class="dt">family=</span><span class="st">'poisson'</span>)</a></code></pre></div>
</div>
<div id="cox-proportional-hazards" class="section level1">
<h1 class="hasAnchor">
<a href="#cox-proportional-hazards" class="anchor"></a>Cox proportional hazards</h1>
<p>The above models all fall into the category of distributions known as exponential families (hence the <code>family</code>) argument. <code>ncvreg</code> also allows users to fit Cox proportional hazards models, although these models fall outside this framework and are therefore fit using a different function, <code>ncvsurv</code>. In Cox regression, the deviance is <span class="math display">\[
L(\bb|\X,\y) = -2\sum_{j=1}^{m} d_j \eta_j + 2\sum_{j=1}^{m} d_j \log\left\{\sum_{i \in R_j} \exp(\eta_i)\right\},
\]</span> where <span class="math inline">\(t_1 &lt; t_2 &lt; \ldots &lt; t_m\)</span> denotes an increasing list of unique failure times indexed by <span class="math inline">\(j\)</span> and <span class="math inline">\(R_j\)</span> denotes the set of observations still at risk at time <span class="math inline">\(t_j\)</span>, known as the risk set.</p>
<p>The <code>Lung</code> data (see <code><a href="../../reference/Lung.html">?Lung</a></code> for more details) provides an example of time-to-event data that can be used with Cox regression. Loading this data set into R,</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(Lung)</a>
<a class="sourceLine" id="cb13-2" title="2">X &lt;-<span class="st"> </span>Lung<span class="op">$</span>X</a>
<a class="sourceLine" id="cb13-3" title="3">y &lt;-<span class="st"> </span>Lung<span class="op">$</span>y</a></code></pre></div>
<p>To fit a penalized Cox regression model,</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/ncvsurv.html">ncvsurv</a></span>(X, y)</a></code></pre></div>
<p>As before, you can call <code>plot</code>, <code>coef</code>, <code>predict</code>, <code>summary</code>, etc. on <code>fit</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(fit, <span class="dt">lambda=</span><span class="fl">0.02</span>)</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="co"># MCP-penalized Cox regression with n=137, p=8</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co"># At lambda=0.0200:</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co"># -------------------------------------------------</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="co">#   Nonzero coefficients         :   7</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="co">#   Expected nonzero coefficients:   4.59</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="co">#   Average mfdr (7 features)    :   0.656</span></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="co"># </span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="co">#           Estimate       z     mfdr Selected</span></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="co"># karno    -0.032745 -6.5040  &lt; 1e-04        *</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co"># squamous -0.853399 -3.7843 0.026061        *</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="co"># large    -0.460405 -2.0522 0.806969        *</span></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="co"># trt       0.294489  1.5967 0.905628        *</span></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="co"># adeno     0.324743  1.3941 0.928532        *</span></a>
<a class="sourceLine" id="cb15-15" title="15"><span class="co"># age      -0.008869 -1.0297 0.952846        *</span></a>
<a class="sourceLine" id="cb15-16" title="16"><span class="co"># prior     0.033326  0.3585 0.969877        *</span></a></code></pre></div>
<p>Cross-validation is similar:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">cvfit &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/cv-ncvreg.html">cv.ncvsurv</a></span>(X, y)</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb16-3" title="3"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cvfit, <span class="dt">type=</span><span class="st">'cve'</span>)</a>
<a class="sourceLine" id="cb16-4" title="4"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cvfit, <span class="dt">type=</span><span class="st">'rsq'</span>)</a></code></pre></div>
<p><img src="models_files/figure-html/models-cox-cv-1.png" width="480"></p>
<p>In addition to the quantities like coefficients and number of nonzero coefficients that <code>predict</code> returns for other types of models, <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> for an <code>ncvsurv</code> object can also estimate the baseline hazard (using the Kalbfleish-Prentice method) and therefore, the survival function. A method to plot the resulting function is also available:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">S &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(fit, X[<span class="dv">1</span>,], <span class="dt">type=</span><span class="st">'survival'</span>, <span class="dt">lambda=</span><span class="fl">0.02</span>)</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw">S</span>(<span class="dv">365</span>)   <span class="co"># Estiamted survival at 1 year</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co"># [1] 0.2447147</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(S, <span class="dt">xlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">200</span>))</a></code></pre></div>
<p><img src="models_files/figure-html/models-cox-surv-single-1.png" width="480"></p>
<p>When multiple subjects are involved in the prediction:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">S &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(fit, X, <span class="dt">type=</span><span class="st">'survival'</span>, <span class="dt">lambda=</span><span class="fl">0.02</span>)</a>
<a class="sourceLine" id="cb18-2" title="2">S[[<span class="dv">1</span>]](<span class="dv">365</span>)  <span class="co"># Estimated survival at 1 year for subject 1</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="co"># [1] 0.2447147</span></a>
<a class="sourceLine" id="cb18-4" title="4">S[[<span class="dv">2</span>]](<span class="dv">365</span>)  <span class="co"># Estimated survival at 1 year for subject 2</span></a>
<a class="sourceLine" id="cb18-5" title="5"><span class="co"># [1] 0.3340281</span></a>
<a class="sourceLine" id="cb18-6" title="6"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(S, <span class="dt">xlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">200</span>))</a></code></pre></div>
<p><img src="models_files/figure-html/models-cox-surv-multiple-1.png" width="480"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#gaussian-linear-regression">Gaussian (linear regression)</a></li>
      <li><a href="#binomial-logistic-regression">Binomial (logistic regression)</a></li>
      <li><a href="#poisson">Poisson</a></li>
      <li><a href="#cox-proportional-hazards">Cox proportional hazards</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Patrick Breheny.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
